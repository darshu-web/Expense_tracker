{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center">
    <h2>Dashboard</h2>
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="dashboardMonthDropdown"
            data-bs-toggle="dropdown" aria-expanded="false">
            {{ current_month_int }}/{{ current_year_int }}
        </button>
        <ul class="dropdown-menu" aria-labelledby="dashboardMonthDropdown">
            {% for m, y in available_months %}
            <li><a class="dropdown-item" href="{{ url_for('main.index', month=m, year=y) }}">{{ m }}/{{ y }}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">Summary ({{ current_month_int }}/{{ current_year_int }})</div>
            <div class="card-body">
                <h3 class="display-6 text-success">Total Spent: ${{ "%.2f"|format(total_spent) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header">Download Report</div>
            <div class="card-body">
                <form action="{{ url_for('main.download_report') }}" method="GET">
                    <div class="mb-3">
                        <select class="form-select" name="month_year">
                            {% for m, y in available_months %}
                            <option value="{{ m }}-{{ y }}" {% if m==current_month_int and y==current_year_int
                                %}selected{% endif %}>
                                {{ m }}/{{ y }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="d-grid gap-2 d-md-block">
                        <button type="submit" name="format" value="pdf" class="btn btn-primary">PDF</button>
                        <button type="submit" name="format" value="csv" class="btn btn-secondary">CSV</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">All Months Summary</div>
            <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                <ul class="list-group list-group-flush">
                    {% for item in monthly_summaries %}
                    <li
                        class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-dark">
                        <span class="fw-bold">{{ item.month }}/{{ item.year }}</span>
                        <span class="badge bg-primary rounded-pill">${{ "%.2f"|format(item.total) }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<h3 class="mt-4">Recent Expenses</h3>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Description</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody>
        {% for expense in expenses %}
        <tr>
            <td>{{ expense.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ expense.category.name }}</td>
            <td>{{ expense.description }}</td>
            <td>${{ "%.2f"|format(expense.amount) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}